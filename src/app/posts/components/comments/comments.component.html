<!-- Modal ver detalle de Post -->
<div class="modal-dialog modal-dialog-centered">
  <div class="modal-content">
    <div class="modal-header text-center">
      <h4 class="modal-title w-100">Publicación de {{postAuthor}}</h4>
      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismissAll('Cross click')"></button>
    </div>
    
    <div class="modal-body">
      <div class="post-details">

        <!-- Información del autor -->
        <div class="d-flex flex-column">
          <div class="d-flex flex-row justify-content-start" *ngIf="institution">
            <img [src]="institution.logo_url" [alt]="'Foto de perfil'" class="img-profile" />
            <div class="info-user">
              <h2>{{ institution.name }}</h2>
              <p>{{calculateTimePost()}}</p>
            </div>
          </div>

          <!-- Descripción del post -->
          <p class="post-description">{{ postDescription }}</p>

            <!-- Imagen del post a la izquierda -->
            <div class="object-fit-md-contain border rounded">

              @if (postImages) {
              <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner image-box text-center">
                  <div *ngFor="let image of postImages; let i = index"
                    class="carousel-item {{ i === 0 ? 'active' : '' }}">
                    @if (image.type === "image"){
                    <img src="{{ image.path}}" class="object-fit-scale" alt="...">
                    }
                    @else if (image.type === "video") {
                    <video [src]="image.path" controls class="video" controls video-control="videoControl"></video>
                    }
                    @else if (image.type === "document") {
                      <div class="iframe-custom-container allowFullScreen">
                      <pdf-viewer [src]="image.path" [render-text]="true" [original-size]="false"
                        style="width: 400px; height: 500px;"
                        [autoresize]="true"
                        
                        class="pdf-viewer"
                        ></pdf-viewer>
                      </div>

                    }

                  </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls"
                  data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls"
                  data-bs-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Next</span>
                </button>
              </div>
              }
            </div>

            <hr class="hr" />

          <!-- Lista de comentarios -->
          <div class="comments-section">
            <app-view-comments [postUuid]="postUuid"></app-view-comments>
          </div>

          <!-- 🔥 ÚNICO input de comentarios -->
          <div class="d-flex flex-row">
            <img [src]="currentUser?.photo_profile_path || 'default-avatar.png'" alt="Foto de perfil" class="comment-img">

            <!-- Botón para escribir un comentario (solo si el input NO está abierto) -->
            <button *ngIf="!showCommentInput && authenticated" type="button" class="comment-button" (click)="toggleCommentInput()">
              <i class="bi bi-chat-left-text"></i> Escribe un comentario...
            </button>

            <!-- Input para escribir comentario (se muestra solo cuando el usuario lo activa) -->
            <div *ngIf="showCommentInput && authenticated" class="comment-box">
              <input #commentInput [(ngModel)]="newComment" 
                     placeholder="Escribe un comentario..." 
                     class="comment-input" 
                     (keydown.enter)="addComment()">
              <button (click)="addComment()" class="send-comment-button">
                <i class="bi bi-send"></i>
              </button>
            </div>
          </div>
          <!-- 🔥 FIN del input de comentarios -->
        </div>
      </div>
    </div>
  </div>
</div>
